{"version":3,"file":"address_and_contact.min.js","sources":["../../../apps/bloomstack_core/bloomstack_core/public/js/address_and_contact.js"],"sourcesContent":["frappe.provide('frappe.contacts')\n\n$.extend(frappe.contacts, {\n\tclear_address_and_contact: function (frm) {\n\t\tfrm.fields_dict['address_html'] && $(frm.fields_dict['address_html'].wrapper).html(\"\");\n\t\tfrm.fields_dict['contact_html'] && $(frm.fields_dict['contact_html'].wrapper).html(\"\");\n\t},\n\n\trender_address_and_contact: function (frm) {\n\t\t// render address\n\t\tif (frm.fields_dict['address_html'] && \"addr_list\" in frm.doc.__onload) {\n\t\t\t$(frm.fields_dict['address_html'].wrapper)\n\t\t\t\t.html(frappe.render_template(\"address_list\",\n\t\t\t\t\tfrm.doc.__onload))\n\t\t\t\t.find(\".btn-address\").on(\"click\", function () {\n\t\t\t\t\tfrappe.new_doc(\"Address\");\n\t\t\t\t});\n\t\t}\n\n\t\t$(document).on('click', '.btn-address-link', function () {\n\t\t\tfrappe.prompt({\n\t\t\t\t\tlabel: \"Link Address\",\n\t\t\t\t\tfieldname: \"address\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"Address\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\tlet addr_list = frm.doc.__onload.addr_list.map(addr => addr.name);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\"name\": [\"not in\", addr_list]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(data) => {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"bloomstack_core.utils.link_address_or_contact\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\"ref_doctype\": \"Address\",\n\t\t\t\t\t\t\t\"ref_name\": data.address,\n\t\t\t\t\t\t\t\"link_doctype\": frm.doctype,\n\t\t\t\t\t\t\t\"link_name\": frm.docname\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\twindow.location.reload()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}, __(\"Select Address\"));\n\t\t})\n\n\t\t$(document).on('click', '.address-box a.unlink_address', function () {\n\t\t\tvar name = $(this).attr('data_address_name');\n\t\t\tfrappe.confirm(\n\t\t\t\t`Are you sure you want to unlink this address with ${cur_frm.docname}?`,\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"bloomstack_core.utils.unlink_address_or_contact\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\"ref_doctype\": \"Address\",\n\t\t\t\t\t\t\t\"ref_name\": name,\n\t\t\t\t\t\t\t\"doctype\": cur_frm.doctype,\n\t\t\t\t\t\t\t\"name\": cur_frm.docname\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\twindow.location.reload()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t$(document).on('click', '.address-box a.delete_address', function () {\n\t\t\tvar name = $(this).attr('data_address_name');\n\t\t\tfrappe.confirm(\n\t\t\t\t`If this address is linked to any other entity in the system, it will instead remove the address from ${cur_frm.docname}.<br><br>\n\t\t\t\t\tAre you sure you want to delete this address?`,\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"bloomstack_core.utils.delete_address_or_contact\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\"ref_doctype\": \"Address\",\n\t\t\t\t\t\t\t\"ref_name\": name,\n\t\t\t\t\t\t\t\"doctype\": cur_frm.doctype,\n\t\t\t\t\t\t\t\"name\": cur_frm.docname\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\twindow.location.reload()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t// render contact\n\t\tif (frm.fields_dict['contact_html'] && \"contact_list\" in frm.doc.__onload) {\n\t\t\t$(frm.fields_dict['contact_html'].wrapper)\n\t\t\t\t.html(frappe.render_template(\"contact_list\",\n\t\t\t\t\tfrm.doc.__onload))\n\t\t\t\t.find(\".btn-contact\").on(\"click\", function () {\n\t\t\t\t\tfrappe.new_doc(\"Contact\");\n\t\t\t\t}, \n\t\t\t\t);\n\t\t}\n\n\t\t$(document).on('click', '.btn-contact-link', function () {\n\t\t\tfrappe.prompt({\n\t\t\t\t\tlabel: \"Link Contact\",\n\t\t\t\t\tfieldname: \"contact\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"Contact\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\tlet contact_list = frm.doc.__onload.contact_list.map(contact => contact.name);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\"name\": [\"not in\", contact_list]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(data) => {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"bloomstack_core.utils.link_address_or_contact\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\"ref_doctype\": \"Contact\",\n\t\t\t\t\t\t\t\"ref_name\": data.contact,\n\t\t\t\t\t\t\t\"link_doctype\": frm.doctype,\n\t\t\t\t\t\t\t\"link_name\": frm.docname\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\twindow.location.reload()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}, __(\"Select Contact\"));\n\t\t});\n\n\t\t$(document).on('click', '.address-box a.unlink_contact', function () {\n\t\t\tvar name = $(this).attr('data_contact_name');\n\t\t\tfrappe.confirm(\n\t\t\t\t`Are you sure you want to unlink this contact with ${cur_frm.docname}?`,\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"bloomstack_core.utils.unlink_address_or_contact\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\"ref_doctype\": \"Contact\",\n\t\t\t\t\t\t\t\"ref_name\": name,\n\t\t\t\t\t\t\t\"doctype\": cur_frm.doctype,\n\t\t\t\t\t\t\t\"name\": cur_frm.docname\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\twindow.location.reload()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t$(document).on('click', '.address-box a.delete_contact', function () {\n\t\t\tvar name = $(this).attr('data_contact_name');\n\t\t\tfrappe.confirm(\n\t\t\t\t`If this contact is linked to any other entity in the system, it will instead remove the contact from ${cur_frm.docname}.<br><br>\n\t\t\t\t\t\t\tAre you sure you want to delete this contact?`,\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"bloomstack_core.utils.delete_address_or_contact\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\"ref_doctype\": \"Contact\",\n\t\t\t\t\t\t\t\"ref_name\": name,\n\t\t\t\t\t\t\t\"doctype\": cur_frm.doctype,\n\t\t\t\t\t\t\t\"name\": cur_frm.docname\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\twindow.location.reload()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t}\n})"],"names":["let"],"mappings":"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"}